<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Jennifer | Imdrasil Homebrew Stuff</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Jennifer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Personal site" />
<meta property="og:description" content="Personal site" />
<link rel="canonical" href="https://imdrasil.github.io/jennifer.cr/" />
<meta property="og:url" content="https://imdrasil.github.io/jennifer.cr/" />
<meta property="og:site_name" content="Imdrasil Homebrew Stuff" />
<script type="application/ld+json">
{"description":"Personal site","@type":"WebPage","url":"https://imdrasil.github.io/jennifer.cr/","headline":"Jennifer","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://imdrasil.github.io/feed.xml" title="Imdrasil Homebrew Stuff" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Imdrasil Homebrew Stuff</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/email_opener/">Email Opener</a><a class="page-link" href="/sage/">Sage</a><a class="page-link" href="/flash_container.cr/">flash_container</a><a class="page-link" href="/jennifer.cr/">Jennifer</a><a class="page-link" href="/jennifer_sqlite3_adapter/">Jennifer SQLite3 adapter</a><a class="page-link" href="/http_method_emulator/">http_method_emulator</a><a class="page-link" href="/sam.cr/">Sam</a><a class="page-link" href="/view_model.cr/">ViewModel</a><a class="page-link" href="/form_object/">FormObject</a><a class="page-link" href="/hermes.cr/">Hermes</a><a class="page-link" href="/crymagick/">CryMagick</a><a class="page-link" href="/factory/">Factory</a><a class="page-link" href="/pager/">Pager</a><a class="page-link" href="/ifrit/">Ifrit</a><a class="page-link" href="/email_opener/versions.html">email_opener</a><a class="page-link" href="/sage/versions.html">sage</a><a class="page-link" href="/flash_container.cr/versions.html">flash_container.cr</a><a class="page-link" href="/jennifer.cr/versions.html">jennifer.cr</a><a class="page-link" href="/jennifer_sqlite3_adapter/versions.html">jennifer_sqlite3_adapter</a><a class="page-link" href="/http_method_emulator/versions.html">http_method_emulator</a><a class="page-link" href="/sam.cr/versions.html">sam.cr</a><a class="page-link" href="/view_model.cr/versions.html">view_model.cr</a><a class="page-link" href="/form_object/versions.html">form_object</a><a class="page-link" href="/hermes.cr/versions.html">hermes.cr</a><a class="page-link" href="/crymagick/versions.html">crymagick</a><a class="page-link" href="/factory/versions.html">factory</a><a class="page-link" href="/pager/versions.html">pager</a><a class="page-link" href="/ifrit/versions.html">ifrit</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Jennifer</h1>
  </header>

  <div class="post-content">
    <h1 id="jennifer---">Jennifer <a href="https://travis-ci.org/imdrasil/jennifer.cr"><img src="https://travis-ci.org/imdrasil/jennifer.cr.svg" alt="Build Status" /></a> <a href="https://github.com/imdrasil/jennifer.cr/releases"><img src="https://img.shields.io/github/release/imdrasil/jennifer.cr.svg" alt="Latest Release" /></a> <a href="https://imdrasil.github.io/jennifer.cr/docs/"><img src="https://img.shields.io/badge/docs-available-brightgreen.svg" alt="Docs" /></a></h1>

<p>ActiveRecord pattern implementation for Crystal with a powerful query DSL, validation, relationship definition, translation and migration mechanism.</p>

<h2 id="installation">Installation</h2>

<p>Add this to your application’s <code class="highlighter-rouge">shard.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">jennifer</span><span class="pi">:</span>
    <span class="na">github</span><span class="pi">:</span> <span class="s">imdrasil/jennifer.cr</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">~&gt;</span><span class="nv"> </span><span class="s">0.7.0"</span>
</code></pre></div></div>

<h3 id="requirements">Requirements</h3>

<ul>
  <li>you need to choose one of existing drivers for your db: <a href="https://github.com/crystal-lang/crystal-mysql">mysql</a> or <a href="https://github.com/will/crystal-pg">postgres</a>; sqlite3 adapter automatically installs required driver for itself;</li>
  <li>crystal <code class="highlighter-rouge">&gt;= 0.26.1</code>.</li>
</ul>

<h2 id="usage">Usage</h2>

<p>Jennifer allows you to maintain everything for your models - from db migrations and field mapping to callbacks and building queries. For detailed information see the <a href="https://imdrasil.github.io/jennifer.cr/docs/">guide</a> and <a href="https://imdrasil.github.io/jennifer.cr/versions">API documentation</a>.</p>

<h3 id="migration">Migration</h3>

<p>To start using Jennifer you’ll first need to generate a migration:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> generate:migration CreateContact
</code></pre></div></div>

<p>then fill the created migration file with content:</p>

<pre><code class="language-crystal">class CreateContact &lt; Jennifer::Migration::Base
  def up
    # Postgres requires to create specific enum type
    create_enum(:gender_enum, ["male", "female"])
    create_table(:contacts) do |t|
      t.string :name, {:size =&gt; 30}
      t.integer :age
      t.integer :tags, {:array =&gt; true}
      t.field :gender, :gender_enum
      t.timestamps
    end
  end

  def down
    drop_table :contacts
    drop_enum(:gender_enum)
  end
end
</code></pre>

<p>and run</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> db:setup
</code></pre></div></div>

<p>to create the database and run the newly created migration.</p>
<blockquote>
  <p>For command management Jennifer uses <a href="https://github.com/imdrasil/sam.cr">Sam</a>.</p>
</blockquote>

<h3 id="model">Model</h3>

<p>Jennifer provides next features:</p>

<ul>
  <li>flexible model schema definition</li>
  <li>relationship definition (<code class="highlighter-rouge">belongs_to</code>, <code class="highlighter-rouge">has_many</code>, <code class="highlighter-rouge">has_one</code>, <code class="highlighter-rouge">has_and_belongs_to_many</code>)</li>
  <li>validation</li>
  <li>model-specific query scope definition</li>
  <li>callbacks</li>
  <li>view support</li>
  <li>translations</li>
</ul>

<p>Hers is model example:</p>

<pre><code class="language-crystal">class Contact &lt; Jennifer::Model::Base
  with_timestamps
  mapping(
    id: Primary32, # is an alias for Int32? primary key
    name: String,
    gender: { type: String?, default: "male" },
    age: { type: Int32, default: 10 },
    description: String?,
    created_at: Time?,
    updated_at: Time?
  )

  has_many :facebook_profiles, FacebookProfile
  has_and_belongs_to_many :countries, Country
  has_and_belongs_to_many :facebook_many_profiles, FacebookProfile, join_foreign: :profile_id
  has_one :passport, Passport

  validates_inclusion :age, 13..75
  validates_length :name, minimum: 1, maximum: 15
  validates_with_method :name_check

  scope :older { |age| where { _age &gt;= age } }
  scope :ordered { order(name: :asc) }

  def name_check
    return unless description &amp;&amp; description.not_nil!.size &gt; 10
    errors.add(:description, "Too large description")
  end
end
</code></pre>

<p>More details you can find in the documentation.</p>

<h3 id="query-dsl">Query DSL</h3>

<p>Jennifer allows you to query the db using a flexible DSL:</p>

<pre><code class="language-crystal">Contact.all.left_join(Passport) { _contact_id == _contact__id }
            .order(id: :asc).order(Contact._name.asc.nulls_last)
            .with(:passport).to_a
Contact.all.eager_load(:countries).where { __countries { _name.like("%tan%") } }
Contact.all.group(:gender).group_avg(:age, PG::Numeric)
</code></pre>

<p>Much more about the query DSL can be found on the wiki <a href="/jennifer.cr/docs/query_dsl.html">page</a>.</p>

<h3 id="versioning">Versioning</h3>

<p>Now that Jennifer is under heavy development, there could be many breaking changes. So please check the release notes to check if any of the changes may prevent you from using it. Also, until this library reaches a beta version, the next version rules will be followed:</p>

<ul>
  <li>
    <p>all bugfixes, new minor features or (sometimes) ones that don’t break the existing API will be added as a patch number (e.g. 0.3.<strong>4</strong>);</p>
  </li>
  <li>
    <p>all breaking changes and new important features (as well as reaching a milestone) will be added by bumping the minor digit (0.<strong>4</strong>.0);</p>
  </li>
</ul>

<p>So even a patch version change could bring a lot of new stuff.</p>

<p>If there is a branch for the next release - it will be removed 1 month after the release. So please use them only as a hotfix or for experiments or contribution.</p>

<h3 id="test-tips">Test tips</h3>

<p>The fastest way to rollback all changes in the DB after test case is by using a transaction. So add:</p>

<pre><code class="language-crystal">Spec.before_each do
  Jennifer::Adapter.adapter.begin_transaction
end

Spec.after_each do
  Jennifer::Adapter.adapter.rollback_transaction
end
</code></pre>

<p>to your <code class="highlighter-rouge">spec_helper.cr</code>. NB. you could simply use regular deleting or truncation, but a transaction will provide a 15x speed up (at least for postgres; mysql gets less impact).</p>

<blockquote>
  <p>This functions can be safely used only under test environment.</p>
</blockquote>

<h2 id="development">Development</h2>

<blockquote>
  <p>Before developing any feature please create an issue where you describe your idea.</p>
</blockquote>

<p>To setup dev environment run <code class="highlighter-rouge">./examples/setup.sh</code> - it creates <code class="highlighter-rouge">./examples/database.yml</code> configuration file. You can override there any values specific to your environment (like db user of password).</p>

<p>To create the databases:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Postgres</span>
<span class="nv">$ </span>make sam db:setup

<span class="c"># Mysql</span>
<span class="nv">$ DB</span><span class="o">=</span>mysql make same db:setup
</code></pre></div></div>

<h3 id="running-tests">Running tests</h3>

<p>All unit tests are written using core <code class="highlighter-rouge">spec</code>. Also in <code class="highlighter-rouge">spec/spec_helper.cr</code> some custom unit test matchers are defined. All migrations are under the <code class="highlighter-rouge">./examples/migrations</code> directory.</p>

<p>The common way to run tests is just use using regular crystal spec tool:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal spec
</code></pre></div></div>

<p>PostgreSQL is used by default, but MySql is also supported while running tests by specifying environment variable <code class="highlighter-rouge">DB=mysql</code>:</p>

<p>In case you need to set the database user or password, use:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ DB_USER</span><span class="o">=</span>user <span class="nv">DB_PASSWORD</span><span class="o">=</span>pass crystal spec
</code></pre></div></div>

<h4 id="integration-tests">Integration tests</h4>

<p>Except unit tests there are also several <em>integration</em> tests. These tests checks possibility to compile and invoke jennifer functionality in some special edge cases (e.g. without defined models, migrations, etc.).</p>

<p>To run integration test just use standard spec runner:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal spec spec/integration/&lt;test_name&gt;.cr
</code></pre></div></div>

<p>Each test file is required to be invoked separately as it may have own configuration.</p>

<p>To run docker-related tests (by the way, all of them run only with mysql) firstly you should run docker container and specify environment variable <code class="highlighter-rouge">DOCKER=1</code>. For more details take a look at <code class="highlighter-rouge">spec/integration/sam/*</code> application files and <code class="highlighter-rouge">examples/run_docker_mysql.sh</code> docker boot script.</p>

<h2 id="documentation">Documentation</h2>

<p>Self documentation is not fully support yet but docs can be compiled using this shell script:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./generate-docs.sh
</code></pre></div></div>

<p>NB. It also depends on then chosen adapter (postgres by default).</p>

<h2 id="similar-shards">Similar shards</h2>

<ul>
  <li><a href="https://github.com/Crecto/crecto">crecto</a> - based on Phoenix’s Ecto lib and follows the repository pattern</li>
  <li><a href="https://github.com/amberframework/granite">granite-orm</a> - lightweight ORM focusing on mapping fields from request to your objects</li>
  <li><a href="https://github.com/topaz-crystal/topaz">topaz</a> - inspired by AR ORM with migration mechanism</li>
  <li><a href="https://github.com/juanedi/micrate">micrate</a> - standalone database migration tool for crystal</li>
</ul>

<h2 id="contributing">Contributing</h2>

<ol>
  <li><a href="https://github.com/imdrasil/jennifer.cr/fork">Fork it</a></li>
  <li>Create your feature branch (git checkout -b my-new-feature)</li>
  <li>Commit your changes (git commit -am ‘Add some feature’)</li>
  <li>Push to the branch (git push origin my-new-feature)</li>
  <li>Create a new Pull Request</li>
</ol>

<p>Please ask me before starting work on smth.</p>

<h2 id="contributors">Contributors</h2>

<ul>
  <li><a href="https://github.com/imdrasil">imdrasil</a> Roman Kalnytskyi - creator, maintainer</li>
</ul>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Imdrasil Homebrew Stuff</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Imdrasil Homebrew Stuff</li><li><a class="u-email" href="mailto:moranibaca@gmail.com">moranibaca@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/imdrasil"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">imdrasil</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Personal site</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
