<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Imdrasil Homebrew Stuff | Personal site</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Imdrasil Homebrew Stuff" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Personal site" />
<meta property="og:description" content="Personal site" />
<link rel="canonical" href="https://imdrasil.github.io/jennifer.cr/docs/configuration.html" />
<meta property="og:url" content="https://imdrasil.github.io/jennifer.cr/docs/configuration.html" />
<meta property="og:site_name" content="Imdrasil Homebrew Stuff" />
<script type="application/ld+json">
{"description":"Personal site","@type":"WebPage","url":"https://imdrasil.github.io/jennifer.cr/docs/configuration.html","headline":"Imdrasil Homebrew Stuff","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://imdrasil.github.io/feed.xml" title="Imdrasil Homebrew Stuff" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Imdrasil Homebrew Stuff</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/email_opener/">Email Opener</a><a class="page-link" href="/sage/">Sage</a><a class="page-link" href="/flash_container.cr/">flash_container</a><a class="page-link" href="/jennifer.cr/">Jennifer</a><a class="page-link" href="/jennifer_sqlite3_adapter/">Jennifer SQLite3 adapter</a><a class="page-link" href="/http_method_emulator/">http_method_emulator</a><a class="page-link" href="/sam.cr/">Sam</a><a class="page-link" href="/view_model.cr/">ViewModel</a><a class="page-link" href="/form_object/">FormObject</a><a class="page-link" href="/hermes.cr/">Hermes</a><a class="page-link" href="/crymagick/">CryMagick</a><a class="page-link" href="/factory/">Factory</a><a class="page-link" href="/pager/">Pager</a><a class="page-link" href="/ifrit/">Ifrit</a><a class="page-link" href="/email_opener/versions.html">email_opener</a><a class="page-link" href="/sage/versions.html">sage</a><a class="page-link" href="/flash_container.cr/versions.html">flash_container.cr</a><a class="page-link" href="/jennifer.cr/versions.html">jennifer.cr</a><a class="page-link" href="/jennifer_sqlite3_adapter/versions.html">jennifer_sqlite3_adapter</a><a class="page-link" href="/http_method_emulator/versions.html">http_method_emulator</a><a class="page-link" href="/sam.cr/versions.html">sam.cr</a><a class="page-link" href="/view_model.cr/versions.html">view_model.cr</a><a class="page-link" href="/form_object/versions.html">form_object</a><a class="page-link" href="/hermes.cr/versions.html">hermes.cr</a><a class="page-link" href="/crymagick/versions.html">crymagick</a><a class="page-link" href="/factory/versions.html">factory</a><a class="page-link" href="/pager/versions.html">pager</a><a class="page-link" href="/ifrit/versions.html">ifrit</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <header class="site-header" role="banner">
  <div class="wrapper">
    <nav class="site-nav">
      <div class="trigger">
        
          <a class="page-link" href="./callbacks">Callbacks</a>
        
          <a class="page-link" href="./model_sti">STI</a>
        
          <a class="page-link" href="./timestamps">Timestamps</a>
        
          <a class="page-link" href="./eager_loading">Eager Loading</a>
        
          <a class="page-link" href="./validation">Validation</a>
        
          <a class="page-link" href="./query_dsl">Query DSL</a>
        
          <a class="page-link" href="./configuration">Configuration</a>
        
          <a class="page-link" href="./index">Jennifer Documentation</a>
        
          <a class="page-link" href="./model_mapping">Mapping</a>
        
          <a class="page-link" href="./view">Views</a>
        
          <a class="page-link" href="./transaction_and_lock">Transaction &amp; Lock</a>
        
          <a class="page-link" href="./time">Time</a>
        
          <a class="page-link" href="./internationalization">Internationalization</a>
        
          <a class="page-link" href="./record">Record</a>
        
          <a class="page-link" href="./migration">Migration</a>
        
          <a class="page-link" href="./pagination_and_ordering">Pagination &amp; Ordering</a>
        
          <a class="page-link" href="./relations">Relations</a>
        
          <a class="page-link" href="./crud">CRUD</a>
        
          <a class="page-link" href="./aggregation">Aggregations</a>
        
          <a class="page-link" href="./authentication">Authentication</a>
        
          <a class="page-link" href="./command_line">Command Line</a>
        
          <a class="page-link" href="./model_scopes">Scopes</a>
        
      </div>
    </nav>
  </div>
</header>

<h1 id="configuration">Configuration</h1>

<p>Put</p>

<pre><code class="language-crystal">require "jennifer"
require "jennifer/adapter/mysql" # for mysql
require "jennifer/adapter/postgres" # for postgres
</code></pre>

<blockquote>
  <p>Be attentive - adapter should be required <strong>after</strong> main staff. From <code class="highlighter-rouge">0.5.0</code> several adapters could be required at the same time.</p>
</blockquote>

<p><a href="https://github.com/imdrasil/jennifer_sqlite3_adapter">SQLite3</a> adapter is in a separate shard.</p>

<p>This should be done before you load your application configurations (or at least models). Now configuration could be loaded from yaml file:</p>

<pre><code class="language-crystal">Jennifer::Config.read("./spec/fixtures/database.yml", :development)
</code></pre>

<p>Second argument presents environment and just use it as namespace key grepping values from yml.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">defaults </span><span class="pi">:</span> <span class="nl">&amp;defaults</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgres</span>
  <span class="na">user</span><span class="pi">:</span> <span class="s">developer</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">1qazxsw2</span>
  <span class="na">migration_files_path</span><span class="pi">:</span> <span class="s">./examples/migrations</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span> <span class="s">jennifer_develop</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span> <span class="s">jennifer_test</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*defaults</span>
</code></pre></div></div>

<p>Also dsl could be used:</p>

<pre><code class="language-crystal">Jennifer::Config.configure do |conf|
  conf.host = "localhost"
  conf.user = "root"
  conf.password = ""
  conf.adapter = "mysql"
  conf.db = "crystal"
  conf.migration_files_path = "./examples/migrations"
end
</code></pre>

<p>If your configurations aren’t stored on the top level - you can manipulate which document subpart will be used to parse parameters:</p>

<pre><code class="language-crystal">Jennifer::Config.read("./spec/fixtures/database.yml", &amp;.["database"]["development"])
</code></pre>

<p>Also configuration can be parsed directly from URI:</p>

<pre><code class="language-crystal">db_uri = "mysql://root@somehost/some_database?max_pool_size=111&amp;initial_pool_size=222&amp;max_idle_pool_size=333&amp;retry_attempts=444&amp;checkout_timeout=555&amp;retry_delay=666"
Jennifer::Config.from_uri(db)
</code></pre>

<h2 id="supported-configuration-parameters">Supported configuration parameters</h2>

<table>
  <thead>
    <tr>
      <th>Config</th>
      <th>Default value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">host</code></td>
      <td><code class="highlighter-rouge">"localhost"</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">port</code></td>
      <td>-1</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">logger</code></td>
      <td><code class="highlighter-rouge">Logger.new(STDOUT)</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">schema</code></td>
      <td><code class="highlighter-rouge">"public"</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">user</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">password</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">db</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">adapter</code></td>
      <td>-</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">pool_size</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">retry_attempts</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">checkout_timeout</code></td>
      <td>5.0</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">retry_delay</code></td>
      <td>1.0</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">local_time_zone_name</code></td>
      <td>default time zone name</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">skip_dumping_schema_sql</code></td>
      <td><code class="highlighter-rouge">false</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">command_shell</code></td>
      <td><code class="highlighter-rouge">"bash"</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">docker_container</code></td>
      <td><code class="highlighter-rouge">""</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">docker_source_location</code></td>
      <td><code class="highlighter-rouge">""</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">command_shell_sudo</code></td>
      <td><code class="highlighter-rouge">false</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">migration_failure_handler_method</code></td>
      <td><code class="highlighter-rouge">"none"</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">migration_files_path</code></td>
      <td><code class="highlighter-rouge">"./db/migrations"</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">model_files_path</code></td>
      <td><code class="highlighter-rouge">"./src/models"</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">structure_folder</code></td>
      <td>parent folder of <code class="highlighter-rouge">migration_files_path</code></td>
    </tr>
  </tbody>
</table>

<p>To avoid port usage set it to <code class="highlighter-rouge">-1</code>. For doing same with the password - assign to it blank value (<code class="highlighter-rouge">""</code>). Empty string also turns off <code class="highlighter-rouge">structure_folder</code> config.</p>

<p>Also configuration can be parsed directly from URI:</p>

<pre><code class="language-crystal">db_uri = "mysql://root@somehost/some_database?max_pool_size=111&amp;initial_pool_size=222&amp;max_idle_pool_size=333&amp;retry_attempts=444&amp;checkout_timeout=555&amp;retry_delay=666"
Jennifer::Config.from_uri(db)
</code></pre>

<p>Also take into account - some configs can’t be initialized using URI string or yaml file but all of them always can be initialized using <code class="highlighter-rouge">Jennifer::Config.configure</code>. Here is the list of such configs:</p>

<table>
  <thead>
    <tr>
      <th>Config</th>
      <th>YAML</th>
      <th>URI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">logger</code></td>
      <td>❌</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">migration_files_path</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">model_files_path</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">local_time_zone_name</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">schema</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">structure_folder</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">skip_dumping_schema_sql</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">docker_container</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">docker_source_location</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">command_shell_sudo</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">migration_failure_handler_method</code></td>
      <td>✔</td>
      <td>❌</td>
    </tr>
  </tbody>
</table>

<p>From <code class="highlighter-rouge">0.5.1</code> <code class="highlighter-rouge">Jennifer::Config</code> has started working under singleton pattern instead of using class as a container for all configuration properties.</p>

<h2 id="logging">Logging</h2>

<p>Jennifer uses regular Crystal logging mechanism so you could specify your own logger or formatter:</p>

<pre><code class="language-crystal"># Here is default logger configuration
Jennifer::Config.configure do |conf|
  conf.logger = Logger.new(STDOUT)

  conf.logger.formatter = Logger::Formatter.new do |severity, datetime, progname, message, io|
    io &lt;&lt; datetime &lt;&lt; ": " &lt;&lt; message
  end
  conf.logger.level = Logger::DEBUG
end
</code></pre>

<h2 id="command-shell">Command Shell</h2>

<p>Some database related operations need to be performed by invoking bash command (like creating or dropping database). By default bash shell is used for such purposes under user invoking this operation, but this may be specified.</p>

<p>To specify another command shell set <code class="highlighter-rouge">command_shell</code> configuration to another registered one. One more onboard command shell is <code class="highlighter-rouge">"docker"</code> but you mau also define your own. To do this you should inherit from <code class="highlighter-rouge">Jennifer::Adapter::ICommandShell</code> abstract class and register it:</p>

<pre><code class="language-crystal">class MySimpleDocker &lt; Jennifer::Adapter::ICommandShell
  def execute(command)
    command_string = String.build do |io|
      io &lt;&lt; "sudo " if config.command_shell_sudo
      io &lt;&lt; "docker exec -i "
      io &lt;&lt; config.docker_container
      io &lt;&lt; " "
      io &lt;&lt; command.executable
      io &lt;&lt; " "
      io &lt;&lt; OPTIONS_PLACEHOLDER
    end
    invoke(command_string, command.options)
  end
end

Jennifer::Adapter::DBCommandInterface.register_shell("my_docker", MySimpleDocker)
</code></pre>

<p><code class="highlighter-rouge">command_shell_sudo</code> enables using <code class="highlighter-rouge">sudo</code> in command line. This will force you to enter a password for your admin user.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Imdrasil Homebrew Stuff</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Imdrasil Homebrew Stuff</li><li><a class="u-email" href="mailto:moranibaca@gmail.com">moranibaca@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/imdrasil"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">imdrasil</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Personal site</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
