<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Sam | Imdrasil Homebrew Stuff</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Sam" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Personal site" />
<meta property="og:description" content="Personal site" />
<link rel="canonical" href="https://imdrasil.github.io/sam.cr/" />
<meta property="og:url" content="https://imdrasil.github.io/sam.cr/" />
<meta property="og:site_name" content="Imdrasil Homebrew Stuff" />
<script type="application/ld+json">
{"description":"Personal site","@type":"WebPage","url":"https://imdrasil.github.io/sam.cr/","headline":"Sam","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://imdrasil.github.io/feed.xml" title="Imdrasil Homebrew Stuff" /></head>
<body><header class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Imdrasil Homebrew Stuff</a>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Sam</h1>
  </header>

  <div class="post-content">
    <h1 id="sam--">Sam <a href="https://travis-ci.org/imdrasil/sam.cr"><img src="https://travis-ci.org/imdrasil/sam.cr.svg" alt="Build Status" /></a> <a href="https://github.com/imdrasil/sam.cr/releases"><img src="https://img.shields.io/github/release/imdrasil/sam.cr.svg" alt="Latest Release" /></a></h1>

<p>Sam is a Make-like utility which allows to specify tasks like Ruby’s Rake do using plain Crystal.</p>

<h2 id="installation">Installation</h2>

<p>Add this to your application’s <code class="highlighter-rouge">shard.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">sam</span><span class="pi">:</span>
    <span class="na">github</span><span class="pi">:</span> <span class="s">imdrasil/sam.cr</span>
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<h3 id="simple-example">Simple example</h3>

<p>Create <code class="highlighter-rouge">sam.cr</code> file in your app root directory and paste next:</p>

<pre><code class="language-crystal"># here you should load your app configuration if
# it will be needed to perform tasks
Sam.namespace "db" do
  namespace "schema" do
    desc "Outputs smth: requires 2 named arguments"
    task "load" do |t, args|
      puts args["f1"]
      t.invoke("1")
      t.invoke("schema:1")
      t.invoke("db:migrate")
      t.invoke("db:db:migrate")
      t.invoke("db:ping")
      t.invoke("din:dong")
      puts "------"
      t.invoke("2", {"f2" =&gt; 1})
    end

    task "1" do
      puts "1"
    end

    task "2", ["1", "db:migrate"] do |t, args|
      puts args.named["f2"].as(Int32) + 3
    end
  end

  namespace "db" do
    task "schema" do
        puts "same as namespace"
    end

    task "migrate" do
      puts "migrate"
    end
  end

  task "ping" do
    puts "ping"
  end
end
Sam.help
</code></pre>

<p>To ran any of this task open prompt in root location and paste:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> &lt;your_task_path&gt; <span class="o">[</span>options]
</code></pre></div></div>

<p>To get list of all available tasks:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> <span class="nb">help</span>
</code></pre></div></div>

<p>Each tasks has own “path” which consists of namespace names and task name joined together by “:”.</p>

<p>Also tasks can accept space separated arguments from prompt. To pass named argument (which have associated name) use next rules:</p>

<ul>
  <li><code class="highlighter-rouge">-name value</code></li>
  <li><code class="highlighter-rouge">-name "value with spaces"</code></li>
  <li><code class="highlighter-rouge">name=value</code></li>
  <li><code class="highlighter-rouge">name="value with spaces"</code></li>
</ul>

<p>Also just array of arguments can be passed - just past everything needed without any flags anywhere:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> &lt;your_task_path&gt; first_raw_option <span class="s2">"options with spaces"</span>
</code></pre></div></div>

<p>All arguments from prompt will be realized as <code class="highlighter-rouge">String</code>.</p>

<p>To invoke a task, e.g. the first task “load” from example above:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crystal sam.cr <span class="nt">--</span> db:schema:load <span class="nt">-f1</span> asd
</code></pre></div></div>

<p>Makefile-like usage is supported. To autogenerate receipt just call</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> generate:makefile
</code></pre></div></div>

<p>This will modify existing Makefile or creates new one. Be careful - this will silent all nonexisting tasks. For more details take a look on template in code. This will allow to call tasks in the next way:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make sam some:task raw_arg1
</code></pre></div></div>

<p>But for named argument you need to add <code class="highlighter-rouge">--</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make sam db:schema:load <span class="nt">--</span> <span class="nt">-f1</span> asd
</code></pre></div></div>

<p>By default it will try to use your samfile in the app root. To override it pass proper way as second argument</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal src/sam.cr <span class="nt">--</span> generate:makefile <span class="s2">"src/sam.cr"</span>
</code></pre></div></div>

<p>To autoload Sam files from your dependencies - just past</p>

<pre><code class="language-crystal">load_dependencies "dep1", "dep2"`
</code></pre>

<p>If library provides some optional files with tasks they could be loaded as well using named tuple  literal:</p>

<pre><code class="language-crystal">load_dependencies "lib1", "lib2": "special_file", "lib3": ["special_file"], "lib3": ["/root_special_file"]
</code></pre>

<p>By default any nested dependency will be loaded from “tasks” folder at the lib root level. Any dependency with leading “/” makes to load them using given path. So <code class="highlighter-rouge">root_special_file</code> for <code class="highlighter-rouge">lib3</code> will be loaded with <code class="highlighter-rouge">lib3/src/lib3/root_special_file.cr</code>.</p>

<p>To execute multiple tasks at once just list them separated by <code class="highlighter-rouge">@</code> character:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal sam.cr <span class="nt">--</span> namespace1:task1 <span class="nv">arg1</span><span class="o">=</span>2 @ other_task <span class="nv">arg1</span><span class="o">=</span>3
</code></pre></div></div>

<p>Each task will be executed only if the previous one is successfully finished (without throwing any exception).</p>

<h4 id="namespace">Namespace</h4>

<p>To define namespace (for now they only used for namespacing tasks) use <code class="highlighter-rouge">Sam.namespace</code> (opens <code class="highlighter-rouge">root</code> namespace) or just <code class="highlighter-rouge">namespace</code> inside of it. <code class="highlighter-rouge">Sam.namespace</code> can be called any times - everything will be added to existing staff.</p>

<h4 id="task">Task</h4>

<p>To define task use <code class="highlighter-rouge">task</code> method with it’s name and block. Given block could take 0..2 arguments: <code class="highlighter-rouge">Task</code> object and <code class="highlighter-rouge">Args</code> object. Also as second parameter could be provided array of dependent tasks which will be invoked before current.</p>

<p>Another task could be invoked from current using <code class="highlighter-rouge">invoke</code> method. It has next signatures:</p>

<p>-</p>
<ul>
  <li><code class="highlighter-rouge">name : String</code> - task path</li>
</ul>

<p>-</p>
<ul>
  <li><code class="highlighter-rouge">name : String</code> - task path</li>
  <li><code class="highlighter-rouge">args : Args</code> - prepared argument object</li>
</ul>

<p>-</p>
<ul>
  <li><code class="highlighter-rouge">name : String</code> - task path</li>
  <li><code class="highlighter-rouge">hash : Hash(String, String | Int32, Float32)</code> - hash with arguments</li>
</ul>

<p>-</p>
<ul>
  <li><code class="highlighter-rouge">name : String</code> - task path</li>
  <li><code class="highlighter-rouge">args : Tuple</code> - raw arguments</li>
</ul>

<p>Any already invoked task is ignored during further invocations. To avoid this <code class="highlighter-rouge">#execute</code> method could be used.</p>

<h4 id="routing">Routing</h4>

<p>When task is invoked from other one provided path will float up through current task namespace nesting and search given path on each level. Task could have same name as any existing namespace.</p>

<h4 id="args">Args</h4>

<p>This class represents argument set for task. It can handle named arguments and just raw array of arguments. Now it supports only <code class="highlighter-rouge">String</code>, <code class="highlighter-rouge">Int32</code> and <code class="highlighter-rouge">Float64</code> types. To get access to named argument you can use <code class="highlighter-rouge">[](name : String)</code> and <code class="highlighter-rouge">[]?(name : String)</code> methods. For raw attributes there are <code class="highlighter-rouge">[](index : Int32)</code> and <code class="highlighter-rouge">[]?(index : Int32)</code> as well.</p>

<h2 id="development">Development</h2>

<p>Before running tests call</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>crystal examples/sam.cr <span class="nt">--</span> setup
</code></pre></div></div>

<h2 id="contributing">Contributing</h2>

<ol>
  <li><a href="https://github.com/imdrasil/sam.cr/fork">Fork it</a></li>
  <li>Create your feature branch (git checkout -b my-new-feature)</li>
  <li>Commit your changes (git commit -am ‘Add some feature’)</li>
  <li>Push to the branch (git push origin my-new-feature)</li>
  <li>Create a new Pull Request</li>
</ol>

<h2 id="contributors">Contributors</h2>

<ul>
  <li><a href="https://github.com/imdrasil/sam.cr">imdrasil</a> Roman Kalnytskyi - creator, maintainer</li>
</ul>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Imdrasil Homebrew Stuff</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Imdrasil Homebrew Stuff</li><li><a class="u-email" href="mailto:moranibaca@gmail.com">moranibaca@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/imdrasil"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">imdrasil</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Personal site</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
